# ğŸ¦­ æµ·è±¹éª°æ—¥å¿—åç«¯ - Workerç‰ˆ

ä¸€ä¸ªæŠ“åŒ…åˆ†æ + è¯¢é—®å¼€å‘è€…åè‡ªå®ç°çš„æµ·è±¹éª°æ—¥å¿—åç«¯é¡¹ç›®ã€‚

æ³¨æ„ï¼æœ¬é¡¹ç›®çš„ç¼–å†™è€…æ˜¯Javascriptåˆå­¦è€…ï¼Œå»ºè®®ç›®å‰å°é²œä½¿ç”¨æœ¬é¡¹ç›®ï¼Œä»¥å…é€ æˆæ•°æ®ä¸¢å¤±ï¼

## ä¼˜ç‚¹

1. è‡ªéƒ¨ç½²ï¼Œæ•°æ®å…¨éƒ¨ç”±è‡ªå·±ï¼ˆï¼Ÿï¼‰æŒæ§
2. ä¾¿å®œã€‚ä»…éœ€è¦ä¸€ä¸ªç»‘å®šåœ¨Cloudflareçš„åŸŸåå³å¯ä½¿ç”¨
3. å®‰å…¨ã€‚ä»…ä½ è‡ªå·±çš„æŸ“è‰²å™¨å¯ä»¥è®¿é—®ï¼ˆå…¶å®å°±æ˜¯è·¨åŸŸé…ç½®ï¼‰

## é™åˆ¶

1. å…è´¹ç‰ˆæœ¬çš„é™åˆ¶å¦‚ä¸‹ï¼š

<img src="../assets/image-20240116212713257.png" alt="image-20240116212713257" style="zoom:50%;" />

è¿™æ„å‘³ç€ä¸€å¤©å¤§æ¦‚æœ€å¤šå†™å…¥1000ä¸ªæ—¥å¿—ã€‚æˆ‘æƒ³è¿™ä¸ªæ•°é‡åº”è¯¥è¶³å¤Ÿç”¨äº†ã€‚

2. éœ€è¦ä¸€ä¸ªåŸŸåï¼Œè¦èŠ±é’±ï¼Œä¸å¦‚ç™½å«–æ¥çš„èˆ’æœ
3. éœ€è¦ç¨å¾®è¿›è¡Œä¸€äº›ç®€å•æ“ä½œï¼Œæ‚¨å¯èƒ½éœ€è¦å¤‡ç”¨ä¸€ä¸ªæ¢¯å­ã€‚å½“ç„¶ï¼Œè‹¥æ‚¨èƒ½ç›´æ¥è®¿é—®Cloudflare.comï¼Œåˆ™å¤§æ¦‚ç‡ä¸éœ€è¦ã€‚

> å¦‚æœæ‚¨å‡ ä¹æ˜¯ç”µè„‘å°ç™½ï¼Œé‚£ä¹ˆä¸‹é¢çš„æ•™ç¨‹å¯èƒ½å¯¹æ‚¨æœ‰äº›å›°éš¾ã€‚æ‚¨æˆ–è®¸éœ€è¦ä¸€äº›æŠ€æœ¯dalaoçš„å¸®åŠ©ã€‚
>
> å¦‚æœæ‚¨æœ¬èº«å°±æ˜¯å¼€å‘è€…ï¼Œé‚£ä¸‹é¢çš„ä¸œè¥¿å¯èƒ½å¯¹æ‚¨æ²¡ä»€ä¹ˆéš¾åº¦Orz

## æ€ä¹ˆç”¨

çº¯ Cloudflare éƒ¨ç½²çš„æ•™ç¨‹ç»§ç»­å¾€ä¸‹çœ‹ï¼ŒCloudflare + Vercel éƒ¨ç½²çš„æ—§æ•™ç¨‹å½’æ¡£åœ¨ [Cloudflare + Vercel éƒ¨ç½²](./archived/deploy-with-cf-and-vercel.md)ã€‚

### æå‰å‡†å¤‡ï¼šè´­ä¹°åŸŸå

é¦–å…ˆæ³¨å†Œä¸€ä¸ªcloudflareè´¦å·å¹¶ç»‘å®šä¸€ä¸ªåŸŸåã€‚è¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼ˆå¯ä»¥é€‰æ‹©è…¾è®¯ï¼Œç™¾åº¦ç­‰å…¶ä»–åŸŸåï¼Œç”šè‡³ä½ å¯ä»¥æœç´¢ä¸€ä¸‹tkå…è´¹åŸŸåï¼Œä½†ä¸€å®šè¦æ˜¯èƒ½æ¢ç»‘åˆ°cloudflareçš„ï¼‰ï¼š

**å¦‚æœä½ æœ‰å¤–å¸æ”¯ä»˜çš„èƒ½åŠ›ï¼Œå»ºè®®ç›´æ¥åœ¨ cloudflare è´­ä¹°åŸŸåã€‚**

ä»¥ä¸‹ä»¥é˜¿é‡Œäº‘è´­ä¹°ä¸ºä¾‹ï¼š

é¦–å…ˆè½¬åˆ°https://wanwang.aliyun.com/domain/ å¹¶ç™»å½•ä¸€ä¸ªè´¦å·ã€‚ç„¶ååœ¨ä¸Šé¢æœç´¢ä½ æƒ³è¦çš„åŸŸååç§°ï¼Œæ¯”å¦‚æ­¤å¤„ä»¥sealdiceisgoodä¸ºä¾‹ï¼š
![image-20240116214413982](./assets/image-20240116214413982.png)

æŒ‘é€‰å¥½å¿ƒä»ªï¼ˆä¾¿å®œï¼‰çš„åŸŸåä¹‹åç›´æ¥èŠ±é’±å³å¯ã€‚ä¹‹åå‚è€ƒï¼š

https://bbs.maozhishi.com/d/56-cloudflare çš„æ–¹å¼ï¼Œå°†åŸŸåæ¢ç»‘åˆ°cloudflareã€‚

### æå‰å‡†å¤‡2ï¼šæ³¨å†ŒGithub

å‡†å¤‡ä¸€æŠŠè¶æ‰‹çš„æ¢¯å­ï¼Œé¦–å…ˆæ³¨å†Œä¸€ä¸ªGithubè´¦å·ã€‚Githubåœ°å€ï¼šhttps://github.com/ å–„ç”¨ç¿»è¯‘ï¼Œæˆ–è€…æ‚¨å¯ä»¥å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/658727572 ã€‚

## ä½¿ç”¨ Cloudflare Pages éƒ¨ç½²æŸ“è‰²å™¨å‰ç«¯

å…ˆè¿›å…¥æµ·è±¹æŸ“è‰²å™¨å‰ç«¯æºç ä»“åº“ https://github.com/sealdice/story-painter æ¥ fork å¯¹åº”é¡¹ç›®ï¼Œè®°ä¸‹ fork åä½ è‡ªå·±ä»“åº“çš„åœ°å€ã€‚ 

![image-20240516220613](./assets/image-20240516220613.png)

è¿›å…¥ cf pages é¡µé¢

![image-20240516220828](./assets/image-20240516220828.png)

é€‰æ‹©åˆ›å»ºåº”ç”¨

![image-20240116221156924](./assets/image-20240116221156924.png)

åˆ›å»º Pages ç«™ç‚¹

![image-20240516221023](./assets/image-20240516221023.png)

è¿æ¥åˆ°ä½ åˆšåˆš fork çš„æµ·è±¹æŸ“è‰²å™¨å‰ç«¯æºç ä»“åº“ï¼Œä»“åº“ååœ¨ä½ æ²¡æœ‰ä¿®æ”¹è¿‡çš„æƒ…å†µä¸‹åº”è¯¥æ˜¯ story-painterã€‚
![image-20240516221324](./assets/image-20240516221324.png)

è®¾ç½®å¯¹åº”éƒ¨ç½²

![image-20240516221628](./assets/image-20240516221628.png)

ä¹‹åç‚¹ä¿å­˜å’Œéƒ¨ç½²ï¼ŒæˆåŠŸåæ‰“å¼€éƒ¨ç½²å¥½çš„ pages ç«™ç‚¹ï¼Œè®¾ç½®è‡ªå®šä¹‰åŸŸ

![image-20240516221932](./assets/image-20240516221932.png)

![image-20240516222123](./assets/image-20240516222123.png)

å¦‚å›¾ï¼Œxxxxæ˜¯ä½ è‡ªå·±èµ·çš„ï¼Œæ³¨æ„è®°ä½ï¼Œè¿™é‡Œä»¥myseal.example.comä¸ºä¾‹ã€‚è®¾ç½®å¥½ä¹‹åç‚¹ç»§ç»­ã€‚

![image-20240516222334](./assets/image-20240516222334.png)

ç‚¹å‡»æ¿€æ´»åŸŸ

## ä½¿ç”¨ Cloudflare Worker éƒ¨ç½²æŸ“è‰²å™¨åç«¯

åˆ°Cloudflareå¤„ï¼Œå¹¶ç‚¹å‡»![image-20240116220952620](./assets/image-20240116220952620.png)

ä»¥è¿”å›ã€‚

æ‰¾åˆ°ï¼š![image-20240116221010246](./assets/image-20240116221010246.png)

ç„¶åç‚¹å‡»KVã€‚åœ¨æ­¤å¤„ç‚¹å‡»â€œCreate Namespaces"

![image-20240116221042195](./assets/image-20240116221042195.png)

éšä¾¿èµ·ä¸ªåï¼ˆè¯·è®°ä½è¿™ä¸ªåå­—ä¸‹é¢è¦ç”¨ï¼‰ï¼Œç„¶åç‚¹å‡»addï¼š

![image-20240116221112864](./assets/image-20240116221112864.png)

å®Œæˆåï¼Œç‚¹å‡»OverViewï¼Œå¹¶ç‚¹å‡»Create Application:

![image-20240116221156924](./assets/image-20240116221156924.png)

ä¹‹åç‚¹å‡»Create Worker:

![image-20240116221223661](./assets/image-20240116221223661.png)

ç„¶åç‚¹å‡»Deploy:

![image-20240116221251121](./assets/image-20240116221251121.png)

å†ç‚¹å‡»Edit Code:

![image-20240116221315564](./assets/image-20240116221315564.png)



å°†æœ¬é¡¹ç›®çš„src/worker.jsé‡Œçš„å†…å®¹å¤åˆ¶ç²˜è´´åˆ°æ–°å‡ºç°çš„å·¦ä¾§é¡µé¢é‡Œï¼š

![image-20240116221424020](./assets/image-20240116221424020.png)

å¹¶å°†ä¸Šä¸€ä¸ªæ­¥éª¤æœ€åçš„åœ°å€ï¼Œæ›¿æ¢urlçš„åœ°å€ï¼ˆæ³¨æ„é‚£ä¸ªæ–œæ åˆ«å¤šäº†æˆ–è€…å°‘äº†ï¼Œä»¥åŠä¸è¦å¤åˆ¶ä¸¤ä¸ªhttpsâ€¦â€¦ï¼‰

æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š

![image-20240116221526909](./assets/image-20240116221526909.png)

ä¹‹åç‚¹å‡»å³ä¸Šè§’çš„Save And Deployã€‚ä¹‹åä»å·¦ä¸Šè§’

![image-20240116221603971](./assets/image-20240116221603971.png)

è¿™é‡Œè¿”å›ã€‚

æ¥ä¸‹æ¥è½¬åˆ°ç•Œé¢ä¸­çš„Triggersä½ç½®ï¼š

![image-20240116221637001](./assets/image-20240116221637001.png)

åœ¨æ­¤å¤„ç‚¹å‡»ï¼šAdd Custom Domain

![image-20240116221658960](./assets/image-20240116221658960.png)

åœ¨æ–°å‡ºç°çš„é¡µé¢é‡Œï¼Œè¾“å…¥xxxxxxxxx.ä½ çš„åŸŸå.ä½ çš„åç¼€ï¼ŒxxxxxxxxxåŒæ ·æ˜¯è‡ªå·±éšä¾¿èµ·ã€‚

![image-20240116221810350](./assets/image-20240116221810350.png)

æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œä»¥è¿™ä¸ªåœ°å€ä¸ºä¾‹(worker.example.com)

å®Œæˆåç‚¹å‡»Add Custom Domainï¼Œç„¶åè½¬åˆ°Settingsï¼š

![image-20240116221920520](./assets/image-20240116221920520.png)

å·¦ä¾§ç‚¹å‡»Varibles:

![image-20240116221942775](./assets/image-20240116221942775.png)

åœ¨å³ä¾§æ‰¾åˆ°ï¼š![image-20240116221957821](./assets/image-20240116221957821.png)

å¦‚å›¾æ“ä½œï¼Œä¹‹åç‚¹å‡»Save and deployï¼š

![image-20240116222041855](./assets/image-20240116222041855.png)

æ¥ä¸‹æ¥æ‚¨å¯ä»¥è®¿é—®xxxxxxxxx.ä½ çš„åŸŸå.ä½ çš„åç¼€(æœ¬ä¾‹æ˜¯worker.example.com)ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œä½ å°†ä¼šçœ‹åˆ°ä¸€å¥è¯ï¼š

![image-20240116222430232](./assets/image-20240116222430232.png)

## ä¿®æ”¹

æ‰“å¼€ä½ è‡ªå·±çš„GitHubï¼Œè¿›å…¥ä½  fork çš„æµ·è±¹æŸ“è‰²å™¨å‰ç«¯ä»“åº“ï¼šï¼ˆä¸‹é¢çš„ç¤ºä¾‹ä¸­ä¿®æ”¹äº†åº“åï¼‰

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/920e6c37-6c95-48b5-9c03-d4e1a71adbc7)

ç‚¹å‡»è¿™ä¸ªé¡¹ç›®è¿›å»ï¼Œä¾æ¬¡ç‚¹å‡»src/store.tsï¼Œä¹‹åç‚¹å‡»é‚£ä¸ªç¬”çš„æŒ‰é’®è¿›è¡Œä¿®æ”¹:

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/4ebf1ab4-38d5-47a8-9c48-22aadb82f9fd)


å°†ï¼š![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/781dd41f-dd4c-489a-9e1b-66119e6df1cc)

ä¿®æ”¹ä¸ºï¼š

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/b0371682-a4d9-43b3-8965-6bb40467c801)

(ä¹Ÿå°±æ˜¯ä¸Šä¸€å¤§æ­¥æœ€åä½ è‡ªå·±èµ·çš„åœ°å€ï¼‰

ç„¶åç‚¹å‡»ï¼š![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/0cf78254-4391-4ef2-ad0f-f7563732fffa)ä¸¤æ¬¡ï¼Œä¿å­˜ä¿®æ”¹ã€‚

ä¹‹ååœ¨ cloudflare pages é‡Œå¯ä»¥çœ‹åˆ°æ­£åœ¨é‡æ–°Buildï¼Œç­‰å¾…æ„å»ºæˆåŠŸ

## è®¾ç½®æµ·è±¹

ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„æµ·è±¹ï¼Œè¿›å…¥ weiui é¡µé¢ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ SealDice 8 æ¬¡æ‰“å¼€é«˜çº§è®¾ç½®é¡µ

å¡«å…¥ä½ çš„åç«¯åœ°å€ + /dice/api/logï¼Œå¦‚ç¤ºä¾‹åç«¯åœ°å€ä¸º worker.example.comï¼Œé‚£ä¹ˆå¡«å…¥ `http://worker.example.com/dice/api/log` å³å¯

![image-20240516223104](./assets/image-20240516223104.png)

## æ€»ç»“

æ€»å…±è¦è®¾ç½®ä¸¤ä¸ªåœ°å€ï¼Œä¸€ä¸ªæ˜¯æŸ“è‰²å™¨åœ°å€ï¼Œä¸€ä¸ªæ˜¯åç«¯åœ°å€ã€‚
