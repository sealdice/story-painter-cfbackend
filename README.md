# ğŸ¦­ æµ·è±¹éª°æ—¥å¿—åç«¯-Workerç‰ˆ

ä¸€ä¸ªæŠ“åŒ…åˆ†æ + è¯¢é—®å¼€å‘è€…åè‡ªå®ç°çš„æµ·è±¹éª°æ—¥å¿—åç«¯é¡¹ç›®ã€‚

æ³¨æ„ï¼æœ¬é¡¹ç›®çš„ç¼–å†™è€…æ˜¯Javascriptåˆå­¦è€…ï¼Œå»ºè®®ç›®å‰å°é²œä½¿ç”¨æœ¬é¡¹ç›®ï¼Œä»¥å…é€ æˆæ•°æ®ä¸¢å¤±ï¼

## ä¼˜ç‚¹

1. è‡ªéƒ¨ç½²ï¼Œæ•°æ®å…¨éƒ¨ç”±è‡ªå·±ï¼ˆï¼Ÿï¼‰æŒæ§
2. ä¾¿å®œã€‚ä»…éœ€è¦ä¸€ä¸ªç»‘å®šåœ¨Cloudflareçš„åŸŸåå³å¯ä½¿ç”¨
3. å®‰å…¨ã€‚ä»…ä½ è‡ªå·±çš„æŸ“è‰²å™¨å¯ä»¥è®¿é—®ï¼ˆå…¶å®å°±æ˜¯è·¨åŸŸé…ç½®ï¼‰

## é™åˆ¶

1. å…è´¹ç‰ˆæœ¬çš„é™åˆ¶å¦‚ä¸‹ï¼š

<img src="./assets/image-20240116212713257.png" alt="image-20240116212713257" style="zoom:50%;" />

è¿™æ„å‘³ç€ä¸€å¤©å¤§æ¦‚æœ€å¤šå†™å…¥1000ä¸ªæ—¥å¿—ã€‚æˆ‘æƒ³è¿™ä¸ªæ•°é‡åº”è¯¥è¶³å¤Ÿç”¨äº†ã€‚

2. éœ€è¦ä¸€ä¸ªåŸŸåï¼Œè¦èŠ±é’±ï¼Œä¸å¦‚ç™½å«–æ¥çš„èˆ’æœ
3. éœ€è¦äº¿å®šçš„æ“ä½œï¼Œæ¶‰åŠåˆ°ç¼–è¯‘ï¼Œéƒ¨ç½²ç­‰ç›¸å…³ã€‚åŒæ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªæ¢¯å­ã€‚ï¼ˆéƒ¨ç½²å®Œæˆåä¸éœ€è¦ï¼Œä¸»è¦æ˜¯Verceléƒ¨ç½²éƒ¨åˆ†éœ€è¦æ¢¯å­ï¼Œå¦‚æœä½ èƒ½è‡ªè¡Œéƒ¨ç½²æŸ“è‰²å™¨ï¼Œåˆ™æ— æ‰€è°“~~æ²¡å‡†ä»¥åæŸ“è‰²å™¨èƒ½è‡ªå·±æ¢åœ°å€å‘¢~~ï¼‰

> å¦‚æœæ‚¨å‡ ä¹æ˜¯ç”µè„‘å°ç™½ï¼Œé‚£ä¹ˆä¸‹é¢çš„æ•™ç¨‹å¯èƒ½å¯¹æ‚¨æœ‰äº›å›°éš¾ã€‚æ‚¨æˆ–è®¸éœ€è¦ä¸€äº›æŠ€æœ¯dalaoçš„å¸®åŠ©ã€‚
>
> å¦‚æœæ‚¨æœ¬èº«å°±æ˜¯å¼€å‘è€…ï¼Œé‚£ä¸‹é¢çš„ä¸œè¥¿å¯èƒ½å¯¹æ‚¨æ²¡ä»€ä¹ˆéš¾åº¦Orz

## æ€ä¹ˆç”¨

### æå‰å‡†å¤‡ï¼šè´­ä¹°åŸŸå

é¦–å…ˆæ³¨å†Œä¸€ä¸ªcloudflareè´¦å·å¹¶ç»‘å®šä¸€ä¸ªåŸŸåã€‚è¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼ˆå¯ä»¥é€‰æ‹©è…¾è®¯ï¼Œç™¾åº¦ç­‰å…¶ä»–åŸŸåï¼Œç”šè‡³ä½ å¯ä»¥æœç´¢ä¸€ä¸‹tkå…è´¹åŸŸåï¼Œä½†ä¸€å®šè¦æ˜¯èƒ½æ¢ç»‘åˆ°cloudflareçš„ï¼‰ï¼š

é¦–å…ˆè½¬åˆ°https://wanwang.aliyun.com/domain/ å¹¶ç™»å½•ä¸€ä¸ªè´¦å·ã€‚ç„¶ååœ¨ä¸Šé¢æœç´¢ä½ æƒ³è¦çš„åŸŸååç§°ï¼Œæ¯”å¦‚æ­¤å¤„ä»¥sealdiceisgoodä¸ºä¾‹ï¼š
![image-20240116214413982](./assets/image-20240116214413982.png)

æŒ‘é€‰å¥½å¿ƒä»ªï¼ˆä¾¿å®œï¼‰çš„åŸŸåä¹‹åç›´æ¥èŠ±é’±å³å¯ã€‚ä¹‹åå‚è€ƒï¼š

https://bbs.maozhishi.com/d/56-cloudflare çš„æ–¹å¼ï¼Œå°†åŸŸåæ¢ç»‘åˆ°cloudflareã€‚

### æå‰å‡†å¤‡2ï¼šæ³¨å†ŒGithubå’ŒVercel

å‡†å¤‡ä¸€æŠŠè¶æ‰‹çš„æ¢¯å­ï¼Œé¦–å…ˆæ³¨å†Œä¸€ä¸ªGithubè´¦å·ã€‚Githubåœ°å€ï¼šhttps://github.com/ å–„ç”¨ç¿»è¯‘ï¼Œæˆ–è€…æ‚¨å¯ä»¥å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/658727572 ã€‚

ä¹‹ååˆ©ç”¨æ¢¯å­æ‰“å¼€vercelç½‘ç«™ï¼šhttps://www.vercel.com/ ï¼Œå¹¶ä½¿ç”¨githubç™»å½•ã€‚ç™»å½•å®Œæˆåå¤§æ¦‚é•¿è¿™æ ·ï¼š

![image-20240116215441310](./assets/image-20240116215441310.png)

ç‚¹å‡»Add Newï¼Œä¹‹åç‚¹å‡»Projectï¼Œç„¶åç‚¹å‡»ï¼š

![image-20240116215522580](./assets/image-20240116215522580.png)

ä¹‹ååœ¨æ–°å‡ºç°çš„ç•Œé¢é‡Œï¼Œç²˜è´´è¿™ä¸ªåœ°å€åç‚¹å‡»continueï¼šhttps://github.com/sealdice/story-painter.git 

åœ¨çº¢è‰²æ–¹æ¡†å¤„å†™ä¸€ä¸ªä½ æƒ³çš„åå­—åç‚¹å‡»Createï¼š

![image-20240116215653749](./assets/image-20240116215653749.png)



æ­¤æ—¶ä¼šè¿™æ ·ï¼š

![image-20240116215725087](./assets/image-20240116215725087.png)

ç­‰å¾…ä¸€ä¼šå„¿åä¼šå˜æˆè¿™æ ·ï¼š

![image-20240116215922039](./assets/image-20240116215922039.png)

ä¿ç•™è¿™ä¸ªé¡µé¢ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥ã€‚

## ç»‘å®šåŸŸå

æ‰“å¼€cloudflareï¼Œæ‰¾åˆ°ä½ çš„åŸŸåï¼š

![image-20240116220034145](./assets/image-20240116220034145.png)



ç‚¹å‡»å®ƒï¼Œç„¶åå¦‚å›¾æ‰€ç¤ºå±•å¼€ï¼š

![image-20240116220117507](./assets/image-20240116220117507-1705413678083-1.png)

æ­¤æ—¶ï¼Œè½¬å›åˆšåˆšè¿™ä¸ªç•Œé¢ï¼š

![image-20240116215922039](./assets/image-20240116215922039.png)

ç‚¹å‡»Add Domain:

![image-20240116220251448](./assets/image-20240116220251448.png)



å¦‚å›¾ï¼Œxxxxæ˜¯ä½ è‡ªå·±èµ·çš„ï¼Œæ³¨æ„è®°ä½ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œä»¥myseal.example.comä¸ºä¾‹ã€‚è®¾ç½®å¥½ä¹‹åç‚¹Addã€‚

ç¬¬ä¸€æ¬¡å¿…ç„¶æŠ¥é”™å¦‚ä¸‹ï¼š

![image-20240116220407789](./assets/image-20240116220407789.png)

æ­¤æ—¶è½¬å›Cloudflareç‚¹Add Record:

![image-20240116220503015](./assets/image-20240116220503015.png)

typeé€‰TXTï¼ŒNameå°±æ˜¯é‚£ä¸ª_vercelï¼ŒContentæ˜¯é‚£ä¸ªç¬¬ä¸‰æ®µå†…å®¹ï¼Œä¹‹åç‚¹Saveä¿å­˜ã€‚

å›åˆ°åˆšåˆšçš„Vercelä½ç½®ï¼Œç‚¹Refreshï¼Œä¼šå‡ºç°æ–°æŠ¥é”™ï¼Œå¦‚å›¾ï¼š

![image-20240116220626383](./assets/image-20240116220626383.png)

ç…§è‘«èŠ¦ç”»ç“¢ï¼Œ**ä½†æ˜¯æ³¨æ„ï¼Œæ­¤å¤„æœ‰ä¸€äº›ä¸åŒ**

![image-20240116220726454](./assets/image-20240116220726454.png)

å®Œæˆåå†æ¬¡åˆ·æ–°ï¼Œæ­¤æ—¶åº”è¯¥æ˜¯å¯ç”¨çŠ¶æ€ï¼Œå¦‚å›¾ï¼š

![image-20240116220804780](./assets/image-20240116220804780.png)

**è®°ä½ä½ çš„åœ°å€ myseal.example.com ã€‚æˆ‘ä»¬ä¸€ä¼šå„¿å°±ä¼šç”¨ä¸Šå®ƒã€‚**

## åˆ›å»ºWorker

åˆ°Cloudflareå¤„ï¼Œå¹¶ç‚¹å‡»![image-20240116220952620](./assets/image-20240116220952620.png)

ä»¥è¿”å›ã€‚

æ‰¾åˆ°ï¼š![image-20240116221010246](./assets/image-20240116221010246.png)

ç„¶åç‚¹å‡»KVã€‚åœ¨æ­¤å¤„ç‚¹å‡»â€œCreate Namespaces"

![image-20240116221042195](./assets/image-20240116221042195.png)

éšä¾¿èµ·ä¸ªåï¼ˆè¯·è®°ä½è¿™ä¸ªåå­—ä¸‹é¢è¦ç”¨ï¼‰ï¼Œç„¶åç‚¹å‡»addï¼š

![image-20240116221112864](./assets/image-20240116221112864.png)

å®Œæˆåï¼Œç‚¹å‡»OverViewï¼Œå¹¶ç‚¹å‡»Create Application:

![image-20240116221156924](./assets/image-20240116221156924.png)

ä¹‹åç‚¹å‡»Create Worker:

![image-20240116221223661](./assets/image-20240116221223661.png)

ç„¶åç‚¹å‡»Deploy:

![image-20240116221251121](./assets/image-20240116221251121.png)

å†ç‚¹å‡»Edit Code:

![image-20240116221315564](./assets/image-20240116221315564.png)



å°†æœ¬é¡¹ç›®çš„src/worker.jsé‡Œçš„å†…å®¹å¤åˆ¶ç²˜è´´åˆ°æ–°å‡ºç°çš„å·¦ä¾§é¡µé¢é‡Œï¼š

![image-20240116221424020](./assets/image-20240116221424020.png)

å¹¶å°†ä¸Šä¸€ä¸ªæ­¥éª¤æœ€åçš„åœ°å€ï¼Œæ›¿æ¢urlçš„åœ°å€ï¼ˆæ³¨æ„é‚£ä¸ªæ–œæ åˆ«å¤šäº†æˆ–è€…å°‘äº†ï¼Œä»¥åŠä¸è¦å¤åˆ¶ä¸¤ä¸ªhttpsâ€¦â€¦ï¼‰

æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š

![image-20240116221526909](./assets/image-20240116221526909.png)

ä¹‹åç‚¹å‡»å³ä¸Šè§’çš„Save And Deployã€‚ä¹‹åä»å·¦ä¸Šè§’

![image-20240116221603971](./assets/image-20240116221603971.png)

è¿™é‡Œè¿”å›ã€‚

æ¥ä¸‹æ¥è½¬åˆ°ç•Œé¢ä¸­çš„Triggersä½ç½®ï¼š

![image-20240116221637001](./assets/image-20240116221637001.png)

åœ¨æ­¤å¤„ç‚¹å‡»ï¼šAdd Custom Domain

![image-20240116221658960](./assets/image-20240116221658960.png)

åœ¨æ–°å‡ºç°çš„é¡µé¢é‡Œï¼Œè¾“å…¥xxxxxxxxx.ä½ çš„åŸŸå.ä½ çš„åç¼€ï¼ŒxxxxxxxxxåŒæ ·æ˜¯è‡ªå·±éšä¾¿èµ·ã€‚

![image-20240116221810350](./assets/image-20240116221810350.png)

æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œä»¥è¿™ä¸ªåœ°å€ä¸ºä¾‹(worker.example.com)

å®Œæˆåç‚¹å‡»Add Custom Domainï¼Œç„¶åè½¬åˆ°Settingsï¼š

![image-20240116221920520](./assets/image-20240116221920520.png)

å·¦ä¾§ç‚¹å‡»Varibles:

![image-20240116221942775](./assets/image-20240116221942775.png)

åœ¨å³ä¾§æ‰¾åˆ°ï¼š![image-20240116221957821](./assets/image-20240116221957821.png)

å¦‚å›¾æ“ä½œï¼Œä¹‹åç‚¹å‡»Save and deployï¼š

![image-20240116222041855](./assets/image-20240116222041855.png)

æ¥ä¸‹æ¥æ‚¨å¯ä»¥è®¿é—®xxxxxxxxx.ä½ çš„åŸŸå.ä½ çš„åç¼€(æœ¬ä¾‹æ˜¯worker.example.com)ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œä½ å°†ä¼šçœ‹åˆ°ä¸€å¥è¯ï¼š

![image-20240116222430232](./assets/image-20240116222430232.png)

## ä¿®æ”¹æºç 

é¦–å…ˆæ‰“å¼€ä½ è‡ªå·±çš„GitHubï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªé¡¹ç›®ï¼ˆå’Œä½ Vercelå½“æ—¶å‘½åæœ‰å…³ç³»ï¼Œå¿˜äº†è¯·å»Vercelçœ‹ï¼‰ï¼š

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/920e6c37-6c95-48b5-9c03-d4e1a71adbc7)

ç‚¹å‡»è¿™ä¸ªé¡¹ç›®è¿›å»ï¼Œä¾æ¬¡ç‚¹å‡»src/store.tsï¼Œä¹‹åç‚¹å‡»é‚£ä¸ªç¬”çš„æŒ‰é’®è¿›è¡Œä¿®æ”¹:

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/4ebf1ab4-38d5-47a8-9c48-22aadb82f9fd)


å°†ï¼š![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/781dd41f-dd4c-489a-9e1b-66119e6df1cc)

ä¿®æ”¹ä¸ºï¼š

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/b0371682-a4d9-43b3-8965-6bb40467c801)

(ä¹Ÿå°±æ˜¯ä¸Šä¸€å¤§æ­¥æœ€åä½ è‡ªå·±èµ·çš„åœ°å€ï¼‰

ç„¶åç‚¹å‡»ï¼š![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/0cf78254-4391-4ef2-ad0f-f7563732fffa)ä¸¤æ¬¡ï¼Œä¿å­˜ä¿®æ”¹ã€‚

ä¹‹ååœ¨Vercelé‡Œç‚¹å‡»Projectå¯ä»¥çœ‹åˆ°æ­£åœ¨é‡æ–°Build,å»ºç«‹æˆåŠŸä¹‹åå°±å¯ä»¥ä½¿ç”¨äº†ï¼

![image](https://github.com/PaienNate/cf_sealdice_logbackend/assets/68044286/efb69a6e-949b-4b4c-b7b2-69b03374af41)

ï¼ˆå¦‚æœä¸çŸ¥é“æ€ä¹ˆçœ‹ï¼Œé‚£ç®€å•â€¦â€¦ç­‰10åˆ†é’Ÿç„¶åå†è¿›è¡Œä¸‹ä¸€æ­¥â€¦â€¦ï¼‰

åˆ° https://github.com/sealdice/sealdice-core æ¥cloneä¸€ä»½æµ·è±¹ã€‚ä¹‹åä¿®æ”¹ dice/utils_log_upload.go ï¼Œå°†é‡Œé¢çš„

```go
var backendUrlsRaw = []string{
	"http://dice.weizaima.com",
}

var BackendUrls = []string{
	"http://dice.weizaima.com",
}
```

ä¿®æ”¹ä¸ºä½ çš„åœ°å€ï¼š

```go
var backendUrlsRaw = []string{
	"https://worker.example.com",//æ³¨æ„ï¼Œhttpè¦æ”¹æˆhttps
}

var BackendUrls = []string{
	"https://worker.example.com",//æ³¨æ„ï¼Œhttpè¦æ”¹æˆhttps
}
```

ç„¶åé‡æ–°ç¼–è¯‘çš„æµ·è±¹å°±å¯ä»¥ç”¨è¾£ã€‚~~~ï¼ˆä»€ä¹ˆä½ é—®æˆ‘ä¸ºä»€ä¹ˆæ²¡æœ‰ç¼–è¯‘æ•™ç¨‹å› ä¸ºæˆ‘ä¸ä¼šgoå•Šæˆ‘å¦‚æœä¼šgoæˆ‘è¿˜æŠ“åŒ…å¹²å•¥ç›´æ¥åˆ†ææºç ä¸å°±å¾—äº†ä»€ä¹ˆä½ é—®æˆ‘é‚£ç¼–è¯‘æ²¡æ•™ç¨‹æ€ä¹ˆåŠæˆ‘ä¹Ÿæ²¡åŠæ³•å•Šæˆ‘è‡ªå·±éƒ½ä¸ä¼šç¼–è¯‘å‘œå‘œå‘œï¼‰~~

æ€»ç»“ï¼šæ€»å…±è¦è®¾ç½®ä¸¤ä¸ªåœ°å€ï¼Œä¸€ä¸ªæ˜¯æŸ“è‰²å™¨åœ°å€ï¼Œä¸€ä¸ªæ˜¯åç«¯åœ°å€ã€‚
